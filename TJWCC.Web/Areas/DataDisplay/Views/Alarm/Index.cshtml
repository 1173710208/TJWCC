
@{
    Layout = null;
}

<body>
    <link href="~/Content/js/bootstrap/bootstrap.css" rel="stylesheet" />
    <script src="~/Content/js/jquery/jquery.js"></script>
    <script src="~/Content/js/echarts/echarts.min.js"></script>
    <script src="~/Content/js/bootstrap/bootstrap.js"></script>
    <link href="~/Content/js/ALTE/css/AdminLTE.min.css" rel="stylesheet" />
    <script src="~/Content/js/ALTE/js/adminlte.js"></script>
    <link href="~/Content/css/site.css" rel="stylesheet" />

    <div class="container-fluid">


        <div class="row">
            <div class="box box-solid box-black-blue ">
                <div class="box-header with-border">
                    <h3 class="box-title">NB-IoT水表总报警分析</h3>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div class="col-md-4">
                        <div class="row">
                            <div class="col-md-12 bg-white" style="height:200px;">
                                <div>
                                    <h3 id="TotalAlarm" class="text-danger" style="font-size:42px;">-</h3>
                                    <span style="font-size:18px;">NB-IoT水表总报警数量（条）</span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div id="AlarmChartPie" style="height:500px;"></div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div id="AlarmChartLine" style="height:700px;"></div>
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
        </div>
    </div>

</body>

<script>

    //饼图
    var AlarmChartPie = echarts.init(document.getElementById('AlarmChartPie'));
    //柱状图
    var AlarmChartCol = echarts.init(document.getElementById('AlarmChartLine'));
    $(function () {

        ///总报警条数
        $.ajax({
            url: "/DataDisplay/Alarm/GetAllAlarmCount",
            type: "get",
            async: false,
            success: function (data) {
                $("#TotalAlarm").text(data);
            }
        });


        ///报警比例
        var alarmChartPieTitle = "";
        var alarmChartPielegendData = [], alarmChartPieData = [];
        $.ajax({
            url: "/DataDisplay/Alarm/GetSubCompanyOnlineRate",
            type: "get",
            async: false,
            success: function (data) {
                var JsonData = JSON.parse(data);
                alarmChartPieTitle = JsonData["Title"];//报警饼图标题
                alarmChartPieData = JSON.parse(JSON.stringify(JsonData["Series"]).toLowerCase());
            }
        });
        AlarmChartPie.setOption({
            title: {
                text: alarmChartPieTitle
            },
            color: ['#f39d77', '#3dceed', '#4466f4', '#d7abea', '#ed7791', '#34db9a','#fd9e46'],
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                bottom: 0,
                left: 'center',
                data: ['类型一', '类型二', '类型三', '类型四', '类型五', '类型六']
            },
            series: [
                {
                    type: 'pie',
                    radius: ['30%', '50%'],
                    center: ['50%', '50%'],//移动位置
                    selectedMode: 'single',
                    data: alarmChartPieData,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)',
                        },
                        normal: {
                            label: {
                                textStyle: {
                                    fontSize: 20,
                                    color: ['black'],
                                }
                            }
                        },

                    },
                    textStyle: {
                        fontSize: 25,
                    },
                }
            ]
        });



        //二级分公司报警柱状图
        var alarmChartColTitle = "";
        var alarmChartCollegendData = [], alarmChartColData = [], ComNames = [], xtitle = [];

        $.ajax({
            url: "/DataDisplay/Alarm/GetSubAlarmType",
            type: "get",
            async: false,
            success: function (data) {
                var JsonData = JSON.parse(data);
                alarmChartColTitle = JsonData["Title"];//报警饼图标题

                $.each(JsonData["Series"], function (i, ele) {
                    alarmChartCollegendData.push(ele.Name);
                    ComNames.push(ele.Name);
                    var d = [];
                    $.each(ele.AlarmTypeCharts, function (j, wele) {
                        if (i == 1) {
                            xtitle.push(wele.Name);
                        }
                        d.push(wele.Value);
                    });
                    var entity = {
                        name: ele.Name,
                        type: 'bar',
                        barGap: 0,
                        data: d
                    }

                    alarmChartColData.push(entity);
                });
            }
        });

        AlarmChartCol.setOption({
            title: {
                text: alarmChartColTitle
            },
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ComNames,

            },
            grid: {
                left: '3%',
                right: '3%',
                bottom: '5%',
                containLabel: true
            },
            calculable: true,
            xAxis: [
                {
                    type: 'category',
                    data: xtitle,
                    splitLine: {

                        show: false

                    },
                },

            ],
            yAxis: [
                {
                    type: 'value'
                }
            ],
            color: ['#3CD2C7', '#FD9E46', '#5D7CFE'],
            series: alarmChartColData
        });


    })
    window.onresize = function () {
        AlarmChartPie.resize();
        AlarmChartCol.resize();
    }
</script>