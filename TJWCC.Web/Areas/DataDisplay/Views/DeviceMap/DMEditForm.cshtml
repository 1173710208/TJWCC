@{
    ViewBag.Title = "Form";
    Layout = "~/Views/Shared/_Form.cshtml";
}

<style>
    .form .formTitle {
        position: relative;
        left: 0px;
        text-align: right;
        white-space: nowrap;
        font-weight: normal;
        width: 110px;
        padding-right: 15px;
    }
</style>
<script>
    var keyValue = $.request("keyValue");
    $(function () {
        if (!!keyValue) {
            $.ajax({
                url: "/DataDisplay/DeviceMap/GetFormJson",
                data: { keyValue: keyValue },
                dataType: "json",
                async: false,
                success: function (data) {
                    $("#dmform1").formSerialize(data);
                    if (data.X != null && data.Y!=null) {
                        var x = data.X / 20037508.34 * 180;
                        var y = data.Y / 20037508.34 * 180;
                        y = 180 / Math.PI * (2 * Math.atan(Math.exp(y * Math.PI / 180)) - Math.PI / 2);
                        $("#X1").attr("value", parseInt(x));
                        $("#X2").attr("value", parseInt(x % 1 * 60));
                        $("#X3").attr("value", (((x % 1 * 60) % 1) * 60).toFixed(2));
                        $("#Y1").attr("value", parseInt(y));
                        $("#Y2").attr("value", parseInt(y % 1 * 60));
                        $("#Y3").attr("value", (((y % 1 * 60) % 1) * 60).toFixed(2));
                    }
                }
            });
        }
    });
    function submitForm() {
        var x = Number($("#X1").val()) + Number($("#X2").val()) / 60 + Number($("#X3").val()) / 3600
        var y = Number($("#Y1").val()) + Number($("#Y2").val()) / 60 + Number($("#Y3").val()) / 3600
        if (!$('#dmform1').formValid()) {
            return false;
        }
        $.submitForm({
            url: "/DataDisplay/DeviceMap/SubmitForm?keyValue=" + keyValue+"&xx="+x+"&yy="+y,
            param: $("#dmform1").formSerialize(),
            success: function () {
                $.loading(false);
                $.currentWindow().$("#btn_search").click();
            }
        })
    }


</script>
<form id="dmform1">
    <div style="margin-top: 10px; margin-left: 10px; margin-right: 10px;">
        <ul class="nav nav-tabs">
            <li role="presentation" class="active"><a href="#">坐标信息</a></li>
        </ul>
        <div style="padding-top: 20px; margin-right: 30px;">
            <table class="form">

                <tr>
                    <th class="formTitle">经度</th>
                    <td class="formValue">
                        <input id="X1" name="X1" type="text" class="form-control" style="width:40px;float:left" />
                        <div style="float:left;height: 30px;line-height: 30px;padding-left: 5px;padding-right: 5px;">度</div>
                        <input id="X2" name="X2" type="text" class="form-control" style="width:40px;float:left" />
                        <div style="float:left;height: 30px;line-height: 30px;padding-left: 5px;padding-right: 5px;">分</div>
                        <input id="X3" name="X3" type="text" class="form-control" style="width:50px;float:left" />
                        <div style="float:left;height: 30px;line-height: 30px;padding-left: 5px;">秒</div>
                    </td>
                </tr>
                <tr>
                    <th class="formTitle">纬度</th>
                    <td class="formValue">
                        <input id="Y1" name="Y1" type="text" class="form-control" style="width:40px;float:left" />
                        <div style="float:left;height: 30px;line-height: 30px;padding-left: 5px;padding-right: 5px;">度</div>
                        <input id="Y2" name="Y2" type="text" class="form-control" style="width:40px;float:left" />
                        <div style="float:left;height: 30px;line-height: 30px;padding-left: 5px;padding-right: 5px;">分</div>
                        <input id="Y3" name="Y3" type="text" class="form-control" style="width:50px;float:left" />
                        <div style="float:left;height: 30px;line-height: 30px;padding-left: 5px;">秒</div>
                    </td>
                </tr>
            </table>
    </div>
    </div>
</form>
