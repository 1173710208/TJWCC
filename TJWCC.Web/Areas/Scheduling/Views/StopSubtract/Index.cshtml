
@{
    ViewBag.Title = "水厂停（减）产";
    Layout = "~/Views/Shared/_Index.cshtml";
}
@* arcgis  *@
<link rel="stylesheet" type="text/css" href="@TJWCC.Code.OperatorProvider.Provider.GetCurrent().ArcGISAPI/dijit/themes/tundra/tundra.css" />
<link rel="stylesheet" type="text/css" href="@TJWCC.Code.OperatorProvider.Provider.GetCurrent().ArcGISAPI/esri/css/esri.css" />
<script src="@TJWCC.Code.OperatorProvider.Provider.GetCurrent().ArcGISAPI/init.js"></script>
@*<link href="~/Areas/DataDisplay/Content/css/bootstrap.css" rel="stylesheet" />*@
<link href="~/Areas/DataDisplay/Content/css/Emergency.css" rel="stylesheet" />
<link href="~/Areas/DataDisplay/Content/css/unite.css" rel="stylesheet" />
<link href="~/Areas/DataDisplay/Content/css/map/indexMap.css" rel="stylesheet" />
<script src="~/Areas/DataDisplay/Content/js/map/map2.js"></script>
<script type="text/javascript">
    var ArcGISServer = "@TJWCC.Code.OperatorProvider.Provider.GetCurrent().ArcGISServer";
    var ArcGISAPI = "@TJWCC.Code.OperatorProvider.Provider.GetCurrent().ArcGISAPI/";
    var PressUnitConv = 100;//水压单位换算
    var PressUnit = "MPa";//水压单位
    var PressPlace = 3;//水压小数位
    var mPressUnit = "mH₂O";//模拟水压单位
    var mPressPlace = 2;//模拟水压小数位
    var ClUnit = "mg/L";//余氯单位
    var BgaUnit = "个/ml";//蓝绿藻单位
    var TurbUnit = "NTU";//浊度单位
    var FlowUnit = "m³/h";//流量单位
    var FlowVUnit = "m/s";//流速单位
    var PLengthUnit = "m";//管长单位
    var PDiameterUnit = "mm";//管径单位
    var JDepthUnit = "m";//埋深单位
    var JElevationUnit = "m";//高程单位
    var JAge = "小时";//水龄单位
</script>
<style>
    .middle211 {
        height: 26px;
        /*width: 100px;*/
        background-color: rgb(33, 111, 237);
        color: rgb(255, 255, 255);
        /*margin-left: 10px;
        margin-right: 10px;*/
        margin-top: 5px;
        border-width: 0px;
        /*border-style: initial;
        border-color: initial;
        border-image: initial;*/
        border-radius: 10px;
        outline: none;
    }
    .map_stss {
        right: 20px;
        bottom: 83px;
        height: 32px;
        width: 32px;
        border: 1px solid rgb(0,0,0);
        border-radius: 7px;
        z-index: 10;
        /*border-left: 0;*/
        position: absolute;
        text-align: center;
        line-height: 34px;
        font-size: 14px;
        float: left;
        color: black;
        background-color: white;
    }

        .map_stss:hover {
            cursor: pointer;
            background-color: rgb(224,236,255);
        }
    .active {
        color: #ffffff;
        background-color: #df7319;
    }
    .disabled {
        background: #ccc;
        border: #ccc;
    }
    /*图例*/
    .legendDiv {
        display: none;
        /*padding:3px;*/
        z-index: 90;
        position: absolute;
        bottom: 70px;
        color: black;
        background-color: rgb(240,247,255);
        width: 195px;
        border: 1px solid rgb(149,184,231);
    }
    .legendClose {
        float: right;
        text-align: center;
        width: 18px;
        height: 18px;
        line-height: 18px;
        border: 1px solid rgb(149,184,231);
        border-radius: 5px;
    }

        .legendClose:hover {
            background-color: rgb(224,236,255);
            cursor: pointer;
        }
    .left {
        height: 660px;
        width: 400px;
        display: flex;
        /*background-color: #fff;*/
        border-radius: 8px;
        /*margin-left: 10px;*/
        display: inline;
    }
    .right16 {
        height: 22px;
        width: 50px;
        border: 0;
        border-radius: 10px;
        background-color: #f87d06;
        color: #fff;
        align-items: center;
    }
    .pdfPostion {
        width: 1100px;
        height: 750px;
        display: block;
        position: absolute;
        top: 50px;
        left: 500px;
        background-color: #525659;
    }
    .pdfTitle {
        width: 200px;
        height: 30px;
        display: block;
        position: absolute;
        top: 10px;
        left: 60px;
        background-color: #323639;
    }
    .pdfTitle1 {
        position: absolute;
        color:white;
        font-size:12px;
        top:10px;
        left:10px;
    }
    .pdfTitle img {
        width: 20px;
        height: 20px;
        position: absolute;
        top: 15px;
        right:10px
    }
    .pdfPostion embed {
        position: absolute;
        width: 1180px;
        height: 750px;
    }
    .esriLegendLayerLabel {
        display: none
    }
</style>
<div class="main-container" style="height:860px;">
    <div class="middle" style="height: 100%">
        <div class="middle1">
            <button id="but_mid1" class="font10 middle11 active" onclick="but_mid1()">方案分析</button>
            <button id="but_mid2" class="font10 middle11" onclick="but_mid2()">数据和文档</button>
        </div>
        <div id="middle" class="middle" style="display:none;height:100%">
            <div class="left">
                <div id="right1" class="right1" style="width:315px;display:inline-block">处置前受影响用户明细表(以地表计,共0块)</div><button class="right16" id="btn_download1" onclick="btn_download1()">导出</button>

                <div class="right2">
                    <table class="right521_title">
                        <tr class="right5211">
                            <th class="right52111">序号</th>
                            <th class="right52111">名称</th>
                            <th class="right52111">地址</th>
                            <th class="right52111">营销公司</th>
                        </tr>
                    </table>
                </div>
                <div class="right522" id="right522_height_1" style="overflow: auto;">
                    <table id="right522_data1" class="right522_data"></table>
                </div>
                <div id="right2" class="right1" style="width:315px;display:inline-block">处置后受影响用户明细表(以地表计,共0块)</div><button class="right16" id="btn_download2" onclick="btn_download2()">导出</button>
                <div class="right2">
                    <table class="right521_title">
                        <tr class="right5211">
                            <th class="right52111">序号</th>
                            <th class="right52111">名称</th>
                            <th class="right52111">地址</th>
                            <th class="right52111">营销公司</th>
                        </tr>
                    </table>
                </div>
                <div class="right522" id="right522_height_2" style="overflow: auto;">
                    <table id="right522_data2" class="right522_data"></table>
                </div>
            </div>
            <div class="pdfPostion">
                @*<div class="pdfTitle">
                    <strong class="pdfTitle1">芥园水厂、津滨水厂停产应急方案</strong>
                    <img src="~/Areas/DataDisplay/Content/img/pdfDownload.png" />
                </div>*@
                <embed id="pdfFile" src="~/Areas/DataDisplay/Content/img/text.pdf" width="1180" height="600" />
                @*<div class="pdfTitle">
                    <strong id="pdfTitle1" class="pdfTitle1">水厂停产应急方案</strong>
                </div>*@
            </div>
        </div>
        <div id="mapbox">
            @* 图例 *@
            <div class="legendDiv" id="legendDivSoto"><div class="legendClose" onclick="legendDivClose()">×</div><div id="legendDiv1" style="float:left"></div></div>
            <div id="map" class="middle2" style="display:block;position: relative;">
                <div class="map_stss" id="fullExtent" onclick="fullExtentClick()">全图</div>
                <button id="showSSB" class="font10 middle11" style="z-index:10;position:absolute;" onclick="showSSB()">调度前影响范围</button>
                <button id="showSSA" class="font10 middle11" style="z-index:10;position:absolute;left:142px" onclick="showSSA()">调度后影响范围</button>
                <img id="loadingImg" src="~/Areas/DataDisplay/Content/img/gif/5-121204193Q8.gif" style="position:absolute;z-index:10;display:none" />
            </div>
        </div>
    </div>

    <div id="right" class="right">
        <div class="right1">水厂停(减)产信息录入</div>
        <!-- 事件类型 -->
        <div class="right2">
            <div class="right21">事件类型：</div>
            <select id="StopType" name="StopType" class="font10" onchange="changeSelect()">
                <option value="1">水厂停产</option>
                <option value="2">水厂减产</option>
                <option value="3">基于当前减产</option>
            </select>
            <button id="showJTSC" class="font10 middle211 active" style="z-index:10;" onclick="showJTSC()">停产水厂设置</button>
            <button id="showGSSC" class="font10 middle211" style="z-index:10;" onclick="showGSSC()">供水水厂设置</button>
        </div>
        <!-- 多选 -->
        <div id="jtscsz" class="right3">
            <div class="right31">
                <div class="right311">
                    <input id="jysc" type="checkbox" onchange="changeCheck1()"><label for="jysc">芥园水厂</label><input id="jyscText" class="right3111 input9_1" style="display:none">
                </div>
                <div class="right311">
                    <input id="lzsc" type="checkbox" onchange="changeCheck2()"><label for="lzsc">凌庄水厂</label><input id="lzscText" class="right3111 input9_1" style="display:none">
                </div>
            </div>
            <div class="right31">
                <div class="right311">
                    <input id="xkhsc" type="checkbox" onchange="changeCheck3()"><label for="xkhsc">新开河水厂</label><input id="xkhscText" class="right3111 input9_1" style="display:none">
                </div>
                <div class="right311">
                    <input id="jbsc" type="checkbox" onchange="changeCheck4()"><label for="jbsc">津滨水厂</label><input id="jbscText" class="right3111 input9_1" style="display:none">
                </div>
            </div>
        </div>
        <div id="gsscsz" class="right3" style="display:none">
            <div class="right31">
                <div class="right311">
                    <input id="gsjysc" type="checkbox" onchange="gsChangeCheck1()"><label for="gsjysc">芥园水厂</label>
                </div>
                <div class="right311">
                    <input id="gslzsc" type="checkbox" onchange="gsChangeCheck2()"><label for="gslzsc">凌庄水厂</label>
                </div>
            </div>
            <div class="right31">
                <div class="right311">
                    <input id="gsxkhsc" type="checkbox" onchange="gsChangeCheck3()"><label for="gsxkhsc">新开河水厂</label>
                </div>
                <div class="right311">
                    <input id="gsjbsc" type="checkbox" onchange="gsChangeCheck4()"><label for="gsjbsc">津滨水厂</label>
                </div>
            </div>
        </div>
        <hr style="height: 1px; border: none; border-top: 1px solid #b4b2b2; margin: 0">
        <!-- 生成方案 -->
        <button id="createPlanBut" onclick="createPlan()" class="right4">生成方案</button>
        <!-- 水厂压力调度 -->
        <div class="right5">
            <div class="right51">水厂压力调度</div>
            <div class="right52">
                <div class="right521">
                    <table class="right521_title">
                        <tr class="right5211">
                            <th class="right52111">水厂</th>
                            <th class="right52111">现状供水压力(MPa)</th>
                            <th class="right52111">现状供水流量(m³/h)</th>
                            <th class="right52111">方案供水压力(MPa)</th>
                            <th class="right52111">方案供水流量(m³/h)</th>
                        </tr>
                    </table>
                </div>
                <div class="right522">
                    <table id="planList" class="right522_data">
                        @*<tr class='right5221'>
                            <td class='right52211'>凌庄水厂</td>
                            <td class='right52211'>0.341</td>
                            <td class='right52211'>15632</td>
                            <td class='right52211'>
                                0.462<span class='glyphicon glyphicon-arrow-up right522111' aria-hidden='true'></span>
                            </td>
                            <td class='right52211'>
                                18965<span class='glyphicon glyphicon-arrow-up right522111' aria-hidden='true'></span>
                            </td>
                        </tr>
                        <tr class='right5221'>
                            <td class='right52211'>津滨水厂</td>
                            <td class='right52211'>-</td>
                            <td class='right52211'>-</td>
                            <td class='right52211'>-</td>
                            <td class='right52211'>-</td>
                        </tr>
                        <tr class='right5221'>
                            <td class='right52211'>新开河水厂</td>
                            <td class='right52211'>0.361</td>
                            <td class='right52211'>16892</td>
                            <td class='right52211'>
                                0.488<span class='glyphicon glyphicon-arrow-up right522111' aria-hidden='true'></span>
                            </td>
                            <td class='right52211'>
                                21596<span class='glyphicon glyphicon-arrow-up right522111' aria-hidden='true'></span>
                            </td>
                        </tr>
                        <tr class='right5221'>
                            <td class='right52211'>芥园水厂</td>
                            <td class='right52211'>-</td>
                            <td class='right52211'>-</td>
                            <td class='right52211'>-</td>
                            <td class='right52211'>-</td>
                        </tr>*@
                    </table>
                </div>
            </div>
        </div>
        <!-- 处置效果对比 -->
        <div class="right6" style="height:145px">
            <div class="right51">处置效果对比</div>
            <div class="right62">
                <div class="right621">
                    <table class="right621_title">
                        <tr class="right6211">
                            <th class="right62111" style="width:60px">&emsp;&emsp;</th>
                            <th class="right62111">受影响用户（以地表计，块）</th>
                            <th class="right62111">影响区域面积（km²）</th>

                        </tr>
                    </table>
                </div>
                <div class="right622">
                    <table id="planResult" class="right622_data">
                        <tr class="right6221">
                            <td class="right62211" style="width:60px">处置前</td>
                            <td class="right62211"></td>
                            <td class="right62211"></td>
                        </tr>
                        <tr class="right6221">
                            <td class="right62211" style="width:60px">处置后</td>
                            <td class="right62211"></td>
                            <td class="right62211"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <hr style="height: 1px; border: none; border-top: 1px dashed #b4b2b2 ;margin:0">
        <!-- 应急处置指令 -->
        <div class="right7">
            <div class="right72">
                <button class="right721" id="scfaBut" onclick="createOrder()" style="color:#fff">下发调令</button>
                @*<button class="right722">编辑</button>
                <button class="right722">确认</button>*@
            </div>
            <div class="right51">应急处置指令</div>
            <div class="right73">
                <div class="right731">
                    <table class="right731_title">
                        <tr class="right7311">
                            <th class="right73111">序号</th>
                            <th class="right73111">水厂</th>
                            <th class="right73111">方案供水压力(MPa)</th>
                        </tr>
                    </table>
                </div>
                <div class="right732" style="height:135px">
                    <table id="orderList" class="right732_data">
                        @*<tr class='right5221'>
                            <td class='right52211'>1</td>
                            <td class='right52211'>凌庄水厂</td>
                            <td class='right52211' >0.462

                            </td>
                        </tr>
                        <tr class='right5221'>
                            <td class='right52211'>2</td>
                            <td class='right52211'>津滨水厂</td>
                            <td class='right52211'>-</td>
                        </tr>
                        <tr class='right5221'>
                            <td class='right52211'>3</td>
                            <td class='right52211'>津滨水厂</td>
                            <td class='right52211'>0.488</td>
                        </tr>
                        <tr class='right5221'>
                            <td class='right52211'>4</td>
                            <td class='right52211'>芥园水厂</td>
                            <td class='right52211'>-</td>
                        </tr>*@
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var isFirstRun = true, isShowSSB = false, isShowSSA = false, isShowJTSC = true, isShowGSSC = false;
    var FullExtent, scList = "", scList1 = "", scList2 = "", scList3 = "", scList4 = "", gsscList = "", gsscList1 = "", gsscList2 = "", gsscList3 = "", gsscList4 = "";
    var tiled2, layerModelBaseMapMin, StopSubBefore, StopSubAfter, planId, legendDisplay, subCount = 0;
    var computeType = 0;
    require([
        "esri/basemaps",
        "esri/map",
        "esri/Color",
        "esri/dijit/Legend",
        "esri/dijit/Scalebar",
        "esri/dijit/HomeButton",
        "esri/dijit/OverviewMap",
        "esri/layers/GraphicsLayer",
        "esri/layers/ArcGISTiledMapServiceLayer",
        "esri/layers/ArcGISDynamicMapServiceLayer",
        "esri/symbols/Font",
        "esri/symbols/TextSymbol",
        "esri/symbols/SimpleMarkerSymbol",
        "esri/symbols/PictureMarkerSymbol",
        "esri/InfoTemplate",
        "dojo/_base/array",
        "dojo/parser",
        "dojo/domReady!"
    ], function (
        esriBasemaps,
        Map,
        Color,
        Legend,
        Scalebar,
        HomeButton,
        OverviewMap,
        GraphicsLayer,
        ArcGISTiledMapServiceLayer,
        ArcGISDynamicMapServiceLayer,
        Font,
        TextSymbol,
        SimpleLineSymbol,
        PictureMarkerSymbol,
        InfoTemplate,
        arrayUtils,
        parser) {
            //font1
            font1 = new Font("13px", Font.STYLE_NORMAL, Font.VARIANT_NORMAL, Font.WEIGHT_BOLDER);
            color1 = new Color([240, 138, 6]);
            color2 = new Color([51, 192, 94]);
            color3 = new Color([0, 105, 244]);
            parser.parse();
            var initExtent = new esri.geometry.Extent({ "xmin": 99192.63530892128, "ymin": 298825.92644339317, "xmax": 100742.03840772746, "ymax": 300589.11330310017, "spatialReference": map.spatialReference });
            esriBasemaps.delorme = {
                baseMapLayers: [
                    //中国矢量地图服务
                    {
                        url: ArcGISServer + "BaseMap/MapServer",
                        id: "底图",
                        opacity: 0.5
                    }
                ],
                //缩略图
                thumbnailUrl: "Imgs/shiliang.jpg",
                title: "矢量图"
            };
            //初始化地图
            map = new Map("map", {
                basemap: "delorme",
                logo: false,
                extent: initExtent,
                fadeOnZoom: true,
                showLabels: true,
                isDoubleClickZoom: false//关闭双击放大
            });

            //禁用键盘缩放平移
            map.disableKeyboardNavigation();
            //卫星底图
            //var toggle = new BasemapToggle({
            //    map: map,
            //    basemap: "satellite"
            //}, "BasemapToggle");
            //toggle.startup();
            //返回主视图
            var home = new HomeButton({
                map: map
            }, "HomeButton");
            home.startup();
            //定位
            //geoLocate = new LocateButton({
            //    map: map
            //}, "LocateButton");
            //geoLocate.startup();
            //鹰眼
            var overviewMapDijit = new OverviewMap({
                map: map,
                expandFactor: 100,
                attachTo: "bottom-left",
                visible: false
            });
            overviewMapDijit.startup();
            //比例尺
            var scalebar = new Scalebar({ map: map, attachTo: "bottom-left", scalebarUnit: "metric" });
            //显示坐标点
            //dojo.connect(map, "onLoad", function () {
            //    dojo.connect(map, "onMouseMove", showCoordinates);
            //    //dojo.connect(map, "onMouseDrag", showCoordinates);
            //    initCLToolbar();//初始化测量工具
            //});
            //基础元素搜索图层
            baseMapServerLayer = ArcGISServer + "ModelBaseMap/MapServer";
            //水泵搜索图层
            pumpMapLayer = ArcGISServer + "ModelBaseMap/MapServer/0";
            //水池搜索图层
            reservoirMapLayer = ArcGISServer + "ModelBaseMap/MapServer/1";
            //消火栓搜索图层
            hydrantMapLayer = ArcGISServer + "ModelBaseMap/MapServer/2";
            //阀门搜索图层
            valveMapLayer = ArcGISServer + "ModelBaseMap/MapServer/3";
            //节点搜索图层
            nodeMapLayer = ArcGISServer + "ModelBaseMap/MapServer/4";
            //管道搜索图层
            pipeMapLayer = ArcGISServer + "ModelBaseMap/MapServer/5";
            //水表搜索图层
            waterMeterMapLayer = ArcGISServer + "CheckMeterService/MapServer/0";
            //管道模拟数据搜索图层
            resultPipeMapLayer = ArcGISServer + "Result_Pipe_D/MapServer/0";
            //源水管网节点搜索图层
            sourceNodeMapLayer = ArcGISServer + "SourceWater_D/MapServer/2";

            //1.定义面的边界线符号
            outline = new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([255, 0, 0]), 3);
            //2.定义面符号
            //BigPolygonSymbol = new SimpleMarkerSymbol().setSize(12).setColor(new dojo.Color([0, 0, 255]));
            //RedBigPolygonSymbol = new SimpleMarkerSymbol().setSize(12).setColor(new dojo.Color([255, 0, 0]));
            //YellowBigPolygonSymbol = new SimpleMarkerSymbol().setSize(12).setColor(new dojo.Color([239, 242, 132]));
            //SmallPolygonSymbol = new SimpleMarkerSymbol().setSize(8).setColor(new dojo.Color([0, 0, 255]));
            BigPolygonSymbol = new PictureMarkerSymbol('Content/myImage/valve.png', 16, 16);
            RedBigPolygonSymbol = new PictureMarkerSymbol('Content/myImage/valves.png', 30, 34).setOffset(0, 17);
            ReBigPolygonSymbol = new PictureMarkerSymbol('Content/myImage/gif/阀.gif', 30, 34).setOffset(0, 17);
            RedGlowPolygonSymbol = new PictureMarkerSymbol('Content/myImage/gif/Red_glow.gif', 45, 45);
            WhiteBigPolygonSymbol = new PictureMarkerSymbol('Content/myImage/gif/Purple_glow.gif', 45, 45);
            YellowBigPolygonSymbol = new PictureMarkerSymbol('Content/myImage/traffic-cone.png', 34, 36).setOffset(0, 5);
            SmallPolygonSymbol = new PictureMarkerSymbol('/Areas/DataDisplay/Content/img/junction.png', 16, 16);
            SmallPressSymbol = new PictureMarkerSymbol('/Areas/DataDisplay/Content/img/press.png', 16, 16).setOffset(0, 8);
            SmallFlowSymbol = new PictureMarkerSymbol('/Areas/DataDisplay/Content/img/flow.png', 16, 16).setOffset(0, 8);
            SmallQualitySymbol = new PictureMarkerSymbol('/Areas/DataDisplay/Content/img/quality.png', 16, 16).setOffset(0, 8);
            WhiteSmallPolygonSymbol = new PictureMarkerSymbol('Content/myImage/gif/Blue_glow.gif', 45, 45);
            ReserviorPolygonSymbol = new PictureMarkerSymbol('Content/myImage/reservior.png', 32, 32);
            PumpPolygonSymbol = new PictureMarkerSymbol('Content/myImage/pump.png', 32, 32);
            HydrantPolygonSymbol = new PictureMarkerSymbol('Content/myImage/hydrant.png', 32, 32);
            pictureMarkerSymbol = new PictureMarkerSymbol('Content/myImage/gif/pipeBreak.gif', 35, 35).setOffset(0, 12);//爆管冒水动画图片
            BlackinfoPictureMSymbol = new PictureMarkerSymbol("Content/myImage/blackinfowin.png", 150, 48).setOffset(0, 24);
            BluePinPictureMSymbol = new PictureMarkerSymbol("Content/myImage/BluePin1LargeB.png", 64, 64).setOffset(0, 32);
            GreenPinPictureMSymbol = new PictureMarkerSymbol("Content/myImage/GreenPin1LargeB.png", 64, 64).setOffset(0, 32);
            BlueCPictureMSymbol = new PictureMarkerSymbol("Content/myImage/BluePin1LargeB.png", 32, 32).setOffset(0, 16);//聚合蓝色气泡标记
            GreenCPictureMSymbol = new PictureMarkerSymbol("Content/myImage/GreenPin1LargeB.png", 64, 64).setOffset(0, 16);//聚合绿色气泡标记
            RedCPictureMSymbol = new PictureMarkerSymbol("Content/myImage/RedPin1LargeB.png", 72, 72).setOffset(0, 16);//聚合红色气泡标记
            PinTextSymbol = new TextSymbol('', new Font("13px", Font.STYLE_NORMAL, Font.VARIANT_NORMAL, Font.WEIGHT_BOLDER), new dojo.Color([0, 0, 0])).setOffset(0, 25);//显示文字
            //overlay = new Echarts3Layer(map, echarts);
            //chartsContainer = overlay.getEchartsContainer();
            //myPipeFlowChart = overlay.initECharts(chartsContainer);
            //管网图
            var infoTemplatePoint = new InfoTemplate("元素信息", "${*}");

            //geometryService = GeometryService("http://" + ArcGISServer.split('/')[2] + "/arcgis/rest/services/Utilities/Geometry/GeometryServer");//几何地图服务
            //将图例图层添加到
            layerModelBaseMap300 = new ArcGISDynamicMapServiceLayer(ArcGISServer + "ModelBaseMap300/MapServer", { id: "小于300管网图", visible: true });//小于300管网图
            map.addLayer(layerModelBaseMap300);
            tiled2 = new ArcGISTiledMapServiceLayer(ArcGISServer + "ModelBaseMap/MapServer", { id: "管网图", visible: true });//管网图层
            //tiled2 = new ArcGISDynamicMapServiceLayer(ArcGISServer + "ModelBaseMap/MapServer", { id: "管网图", visible: true });//管网图层
            map.addLayer(tiled2);
            SourceWater = new ArcGISDynamicMapServiceLayer(ArcGISServer + "SourceWater_D/MapServer", { id: "原水管网图", visible: true });//原水管网图
            //map.addLayer(SourceWater);
            layerModelBaseMapMin = new ArcGISTiledMapServiceLayer(ArcGISServer + "ModelBaseMapMin/MapServer", { id: "细管网图", visible: false });//细管网图层
            map.addLayer(layerModelBaseMapMin);
            Meter = new ArcGISDynamicMapServiceLayer(ArcGISServer + "Meter_D/MapServer", { id: "地表分布图", visible: true });//地表分布图
            map.addLayer(Meter);
            StopSubBefore = new ArcGISDynamicMapServiceLayer(ArcGISServer + "StopSubBefore/MapServer", { id: "水厂停减产前", visible: false });//水厂停减产前
            map.addLayer(StopSubBefore);
            StopSubAfter = new ArcGISDynamicMapServiceLayer(ArcGISServer + "StopSubAfter/MapServer", { id: "水厂停减产后", visible: false });//水厂停减产后
            map.addLayer(StopSubAfter);
            //map.addLayer(layerPressureChange);
            //layerGisPipe = new ArcGISTiledMapServiceLayer(ArcGISServer + "DetailPipeService/MapServer", { id: "管网详图", visible: false });//管网详图
            //map.addLayer(layerGisPipe);
            //计量分区搜索图层
            DBSArea2Laye = ArcGISServer + "MeasureArea_Info/MapServer/0";
            DBSArea1Laye = ArcGISServer + "MeasureArea_Info/MapServer/0";
            DBSArea0Laye = ArcGISServer + "MeasureArea_Info/MapServer/0";
            //图层按钮单击事件
            setLayerVisibility = function (obj) {
                obj.children[0].checked = !(obj.children[0].checked);
                //用dojo.query获取class为listCss的元素数组
                var inputs = dojo.query(".listCBCss");
                var visible = [];
                //对checkbox数组进行变量把选中的id添加到visible
                for (var i = 0; i < inputs.length; i++) {
                    if (inputs[i].checked) {
                        visible.push(inputs[i].id);
                    }
                }
                //设置可视图层
                tiled2.setVisibleLayers(visible);
            };
            maplayersClick = function () {
                if (isMapLayers) {
                    recoverAll();
                    isMapLayers = false;
                } else {
                    recoverAll();
                    $("#maplayers").css("background", "#4b77be");//改变图层按钮颜色
                    var layersDisplay = document.getElementById("layersDisplay");
                    layersDisplay.innerHTML = "";
                    var layers = map.getLayersVisibleAtScale(map.getScale());
                    //layersDisplay
                    layersDisplay.style.display = "block";
                    arrayUtils.forEach(layers, function (layer) {
                        if (layer.id.indexOf("graphicsLayer") <= -1) {
                            layersDisplay.innerHTML += "<div class='layers-display-line' onclick='layersChange(this, 0, false, \"\")'>" + layer.id + "</div>";
                        }
                    });
                    layersDisplay.innerHTML += "<div class='layers-display-close' onclick='recoverAll()'>关闭</div>";
                    isMapLayers = true;
                }
            }
            //graphicslayer
            graphicslayer = new GraphicsLayer();//画图图层
            map.addLayer(graphicslayer);
            tbaGraphicslayer = new GraphicsLayer();//爆管画图图层
            map.addLayer(tbaGraphicslayer);
            map.on("update-start", showLoading);//add by huangxin 20180508地图加载时显示loading图标
            map.on("update-end", hideLoading);//add by huangxin 20180508地图加载完隐藏loading图标
            var identifyParams;//声明查询参数
            function showLoading() {//地图加载时显示loading图标
                $('#loadingImg').css('left', $("#map").width() / 2 - 42 + 'px');
                $('#loadingImg').css('top', $("#map").height() / 2 - 40 + 'px');
                if (isShowSSB || isShowSSA) {
                    esri.show(dojo.byId("loadingImg"));   // 显示图片  
                }
            }

            function hideLoading() {//地图加载完成后隐藏loading图标
                esri.hide(dojo.byId("loadingImg"));
                if (isFirstRun || FullExtent == null) {
                    isFirstRun = false;
                    homeExtent = map.extent;
                    //FullExtent = tiled2.fullExtent;
                    FullExtent = new esri.geometry.Extent({"xmin": 67829.01838268693,"ymin": 266352.6663795429,"xmax": 150842.205242394,"ymax": 317814.22763599874,"spatialReference": map.spatialReference });//地图显示的新区域;
                    //xmax: 13023121.408344664
                    //xmin: 12983527.027692996
                    //ymax: 4639295.278690283
                    //ymin: 4606694.8861267
                    //FullExtent.spatialReference = map.spatialReference;
                    $(".ovwButton.ovwController.ovwShow").click(function () {//鹰眼显示单击事件
                        var tmpdisplay = $(".ovwContainer").css("display");
                        if (tmpdisplay == "none")
                            $("#legendDivSoto").css("bottom", "70px");
                        else
                            $("#legendDivSoto").css("bottom", ($(".ovwContainer").height() + 3) + "px");
                    });
                    //updataTree();
                }
            }
            //图例
            legendDisplay = function (objs, title) {
                if (dijit.byId("legendDiv1")) {
                    $("#legendDiv1").html('');
                    dijit.byId("legendDiv1").destroyRecursive(true);
                }
                var legendLayers = [];
                legendLayers.push({ layer: objs, title: title });
                mapLegend = new Legend({
                    map: map,
                    autoUpdate: true,
                    arrangment: Legend.ALIGN_RIGHT,
                    layerInfos: legendLayers
                }, "legendDiv1");
                mapLegend.startup();
                $("#legendDivSoto").css("display", "block");
            }
            map.infoWindow.resize(245, 125);
        });
    function showJTSC() {
        if (!isShowJTSC) {
            $("#jtscsz").css("display", "block");
            $("#gsscsz").css("display", "none");
            $('#showGSSC').removeClass('active');
            $('#showJTSC').addClass('active');
            isShowJTSC = true;
            isShowGSSC = false;
        }
    }
    function showGSSC() {
        if (!isShowGSSC) {
            $("#jtscsz").css("display", "none");
            $("#gsscsz").css("display", "block");
            $('#showJTSC').removeClass('active');
            $('#showGSSC').addClass('active');
            isShowGSSC = true;
            isShowJTSC = false;
        }
    }
    function showSSB() {
        if (isShowSSB) {
            $('#showSSB').removeClass('active');
            isShowSSB = false;
            StopSubBefore.hide();
            $("#legendDivSoto").css("display", "none");
            tiled2.show();
            layerModelBaseMapMin.hide();
        } else {
            $('#showSSB').addClass('active');
            StopSubBefore.show();
            legendDisplay(StopSubBefore, '水厂停减产前压力(MPa)');
            isShowSSB = true;
            tiled2.hide();
            layerModelBaseMapMin.show();
            if (isShowSSA) {
                $('#showSSA').removeClass('active');
                isShowSSA = false;
                StopSubAfter.hide();
                //$("#legendDivSoto").css("display", "none");
            }
        }
    }
    function showSSA() {
        if (isShowSSA) {
            $('#showSSA').removeClass('active');
            isShowSSA = false;
            StopSubAfter.hide();
            $("#legendDivSoto").css("display", "none");
            tiled2.show();
            layerModelBaseMapMin.hide();
        } else {
            $('#showSSA').addClass('active');
            StopSubAfter.show();
            legendDisplay(StopSubAfter, '水厂停减产后压力(MPa)');
            isShowSSA = true;
            tiled2.hide();
            layerModelBaseMapMin.show();
            if (isShowSSB) {
                $('#showSSB').removeClass('active');
                isShowSSB = false;
                StopSubBefore.hide();
                //$("#legendDivSoto").css("display", "none");
            }
        }
    }
    //查询水力模型是否正在被使用
    function computeTypes() {
        let stopType = $("#StopType").val();
        scList = scList1 + scList2 + scList3 + scList4;
        gsscList = gsscList1 + gsscList2 + gsscList3 + gsscList4;
        if (gsscList.length==0) {
            $.modalAlert("系统提示", "请设置供水水厂！", "error");
            return;
        }
        $.ajax({
            type: "GET",
            url: '/Scheduling/StopSubtract/GetCalStatus?stopType=' + stopType ,
            dataType: "JSON",
            success: function (adata) {
                if (adata == 0) {
                    $('#createPlanBut').addClass('disabled');
                    $("#createPlanBut").attr('disabled', true);
                    $('#but_mid2').removeClass('disabled');
                    $("#but_mid2").attr('disabled', false);
                    $('#showSSB').removeClass('disabled');
                    $("#showSSB").attr('disabled', false);
                    $('#showSSA').removeClass('disabled');
                    $("#showSSA").attr('disabled', false);
                    $('#scfaBut').removeClass('disabled');
                    $("#scfaBut").attr('disabled', false);
                    $.loading(true, '生成方案中...');
                    let stopType = $("#StopType").val();
                    $.ajax({
                        type: "GET",
                        url: "/Scheduling/StopSubtract/CreatePlan?stopType=" + stopType + "&scList=" + scList.substring(0, scList.length - 1) + "&gsscList=" + gsscList.substring(0, gsscList.length - 1) + "&isCal=false",
                        dataType: "JSON",
                        success: function (data) {
                            console.log(data);
                            $.loading();
                            let rowPLs = data[0].split(";");
                            planId = data[3].ID;
                            $("#planList")[0].innerHTML = "";
                            $("#orderList")[0].innerHTML = "";
                            $("#right522_data1")[0].innerHTML = "";
                            $("#right522_data2")[0].innerHTML = "";
                            for (let i = 0; i < rowPLs.length; i++) {
                                let rowPL = rowPLs[i].split(",");
                                $("#planList")[0].innerHTML += "<tr class='right5221'><td class='right52211 down1_1'>" + rowPL[1] + "</td><td class='right52211 down1_2'>" + rowPL[2] + "</td>" +
                                    "<td class='right52211'>" + rowPL[3] + "</td><td class='right52211'>" + (rowPL[4] == "-" ? "-" : rowPL[4]) +
                                    "</td><td class='right52211'>" + (rowPL[5] == "-" ? "-" : rowPL[5]) + "</td></tr>";
                                if (rowPL[4] == '-')
                                    $("#orderList")[0].innerHTML += "<tr class='right5221'><td class='right52211'>" + (i + 1) + "</td><td class='right52211'>" + rowPL[1] + "</td>" +
                                        "<td class='right52211 down1_3' >" + rowPL[4] + "</td></tr>";
                                else
                                    $("#orderList")[0].innerHTML += "<tr class='right5221'><td class='right52211'>" + (i + 1) + "</td><td class='right52211'>" + rowPL[1] + "</td>" +
                                        "<td class='right52211'><input id='" + rowPL[0] + "' value='" + rowPL[4] + "' style='width:30px' class='down1_3'></input></td></tr>";
                            }
                            for (let i1 = 0; i1 < data[4].length; i1++) {
                                let rowi1 = data[4][i1];
                                $("#right522_data1")[0].innerHTML += "<tr class='right5221'><td class='right52211'>" + (i1 + 1) + "</td>" +
                                    "<td class='right52211'>" + rowi1[0] + "</td>" +
                                    "<td class='right52211'>" + rowi1[1] + "</td>" +
                                    "<td class='right52211'>" + rowi1[2] + "</td>" +
                                    "</tr>";
                            }
                            for (let i2 = 0; i2 < data[5].length; i2++) {
                                let rowi1 = data[5][i2];
                                $("#right522_data2")[0].innerHTML += "<tr class='right5221'><td class='right52211'>" + (i2 + 1) + "</td>" +
                                    "<td class='right52211'>" + rowi1[0] + "</td>" +
                                    "<td class='right52211'>" + rowi1[1] + "</td>" +
                                    "<td class='right52211'>" + rowi1[2] + "</td>" +
                                    "</tr>";
                            }
                            $("#planResult").html("<tr class='right6221'><td class='right62211' style='width:90px'> 处置前</td><td class='right62211'>" + data[1][0] + "</td><td class='right62211'>" + data[1][1] + "</td></tr >" +
                                "<tr class='right6221'><td class='right62211' style='width:90px'>处置后</td><td class='right62211'>" + data[2][0] + "</td><td class='right62211'>" + data[2][1] + "</td></tr>");
                            $("#right1").html("处置前受影响用户明细表(以地表计,共" + data[1][0] + "块)");
                            $("#right2").html("处置后受影响用户明细表(以地表计,共" + data[2][0] + "块)");
                            $("#pdfFile").attr('src', data[6]);
                            $.modalMsg("生成方案成功！", "success");
                        }
                    });
                } else {
                    $.modalMsg("水力模型计算正在被其他用户使用中.....", "warning");
                }
            }
        })
    }
    window.onresize = function () {
        var mainH = $(window).height() - 10;
        var mainW = $(window).width();
        $(".main-container").height(mainH);
        $(".main-container").width(mainW);
        $("#pdfFile").height(mainH - 65);
        if (mainH > 900) {
            $("#right522_height_1").height(mainH - 540);
            $("#right522_height_2").height(mainH - 630);
        } else {
            $("#right522_height_1").height(mainH - 500);
            $("#right522_height_2").height(mainH - 523);
        }

        $("#map").height(mainH - 50);
        $("#map").width(mainW - 420);
    }
    window.onload = function () {
        var mainH = $(window).height() - 10;
        var mainW = $(window).width();
        $(".main-container").height(mainH);
        $(".main-container").width(mainW);
        $("#pdfFile").height(mainH - 65);
        if (mainH > 900) {
            $("#right522_height_1").height(mainH - 540);
            $("#right522_height_2").height(mainH - 630);
        } else {
            $("#right522_height_1").height(mainH - 500);
            $("#right522_height_2").height(mainH - 523);
        }
        $("#map").height(mainH - 50);
        $("#map").width(mainW - 420);
        $('#createPlanBut').addClass('disabled');
        $("#createPlanBut").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
    }
    function createPlan() {
        computeTypes();
       
    }
    function changeCheck1() {//水厂复选框调用事件
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        $("#gsjysc").attr("checked", false);
        $("#gslzsc").attr("checked", false);
        $("#gsxkhsc").attr("checked", false);
        $("#gsjbsc").attr("checked", false);
        gsscList = "";
        gsscList1 = "";
        gsscList2 = "";
        gsscList3 = "";
        gsscList4 = "";
        let stopType = $("#StopType").val();
        if ($("#jysc")[0].checked) {
            $("#planList").html("");
            $("#orderList").html("");
            $("#planResult").html("");
            $("#lzsc").attr("disabled", "disabled");
            $("#xkhsc").attr("disabled", "disabled");
            $("#jbsc").attr("disabled", "disabled");
            $("#gsjysc").attr("disabled", "disabled");
            if (stopType == "1" || stopType == "3") {
                $('#createPlanBut').removeClass('disabled');
                $("#createPlanBut").attr('disabled', false);
                if (stopType == "1")
                    scList1 = "10,0;";
                else scList1 = "10,;";
            } else {
                let bfb = parseFloat($("#jyscText").val());
                if (isNaN(bfb)) {
                    $.modalAlert("系统提示", "请输入剩余产能的百分比数字！", "error");
                    $('#jysc').attr("checked", false);
                    $("#lzsc").attr("disabled", false);
                    $("#xkhsc").attr("disabled", false);
                    $("#jbsc").attr("disabled", false);
                    $("#gsjysc").attr("disabled", false);
                    return;
                }
                if (subCount == 3) {
                    $.modalAlert("系统提示", "最多只允许3个水厂减产！", "error");
                    $('#jysc').attr("checked", false);
                    $("#lzsc").attr("disabled", false);
                    $("#xkhsc").attr("disabled", false);
                    $("#jbsc").attr("disabled", false);
                    $("#gsjysc").attr("disabled", false);
                    return;
                }
                $('#createPlanBut').removeClass('disabled');
                $("#createPlanBut").attr('disabled', false);
                $('#jyscText').addClass('disabled');
                $("#jyscText").attr('disabled', true);
                subCount += 1;
                scList1 = "10," + bfb + ";";
            }
        } else {
            if (stopType == "2") {
                subCount -= 1;
                if (subCount == 0) {
                    $('#createPlanBut').addClass('disabled');
                    $("#createPlanBut").attr('disabled', true);
                }
            } else {
                $('#createPlanBut').addClass('disabled');
                $("#createPlanBut").attr('disabled', true);
            }
            $("#jyscText").val('');
            scList1 = "";
            $("#lzsc").attr("disabled", false);
            $("#xkhsc").attr("disabled", false);
            $("#jbsc").attr("disabled", false);
            $("#gsjysc").attr("disabled", false);
            $("#jyscText").attr("disabled", false);
            if (isShowSSA) {
                $('#showSSA').removeClass('active');
                isShowSSA = false;
                StopSubAfter.hide();
                $("#legendDivSoto").css("display", "none");
                tiled2.show();
                layerModelBaseMapMin.hide();
            }
            if (isShowSSB) {
                $('#showSSB').removeClass('active');
                isShowSSB = false;
                StopSubBefore.hide();
                $("#legendDivSoto").css("display", "none");
                tiled2.show();
                layerModelBaseMapMin.hide();
            }
        }
    }
    function changeCheck2() {
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        $("#gsjysc").attr("checked", false);
        $("#gslzsc").attr("checked", false);
        $("#gsxkhsc").attr("checked", false);
        $("#gsjbsc").attr("checked", false);
        gsscList = "";
        gsscList1 = "";
        gsscList2 = "";
        gsscList3 = "";
        gsscList4 = "";
        let stopType = $("#StopType").val();
        if ($("#lzsc")[0].checked) {
            $("#planList").html("");
            $("#orderList").html("");
            $("#planResult").html("");
            $("#jysc").attr("disabled", "disabled");
            $("#xkhsc").attr("disabled", "disabled");
            $("#jbsc").attr("disabled", "disabled");
            $("#gslzsc").attr("disabled", "disabled");
            if (stopType == "1" || stopType == "3") {
                $('#createPlanBut').removeClass('disabled');
                $("#createPlanBut").attr('disabled', false);
                if (stopType == "1")
                    scList2 = "11,0;";
                else scList2 = "11,;";
            } else {
                let bfb = parseFloat($("#lzscText").val());
                if (isNaN(bfb)) {
                    $.modalAlert("系统提示", "请输入剩余产能的百分比数字！", "error");
                    $('#lzsc').attr("checked", false);
                    $("#jysc").attr("disabled", false);
                    $("#xkhsc").attr("disabled", false);
                    $("#jbsc").attr("disabled", false);
                    $("#gslzsc").attr("disabled", false);
                    return;
                }
                if (subCount == 3) {
                    $.modalAlert("系统提示", "最多只允许3个水厂减产！", "error");
                    $('#lzsc').attr("checked", false);
                    $("#jysc").attr("disabled", false);
                    $("#xkhsc").attr("disabled", false);
                    $("#jbsc").attr("disabled", false);
                    $("#gslzsc").attr("disabled", false);
                    return;
                }
                $('#createPlanBut').removeClass('disabled');
                $("#createPlanBut").attr('disabled', false);
                $('#lzscText').addClass('disabled');
                $("#lzscText").attr('disabled', true);
                subCount += 1;
                scList2 = "11," + bfb + ";";
            }
        } else {
            if (stopType == "2") {
                subCount -= 1;
                if (subCount == 0) {
                    $('#createPlanBut').addClass('disabled');
                    $("#createPlanBut").attr('disabled', true);
                }
            } else {
                $('#createPlanBut').addClass('disabled');
                $("#createPlanBut").attr('disabled', true);
            }
            $("#lzscText").val('');
            scList2 = "";
            $("#jysc").attr("disabled", false);
            $("#xkhsc").attr("disabled", false);
            $("#jbsc").attr("disabled", false);
            $("#gslzsc").attr("disabled", false);
            $("#lzscText").attr("disabled", false);
            if (isShowSSA) {
                $('#showSSA').removeClass('active');
                isShowSSA = false;
                StopSubAfter.hide();
                $("#legendDivSoto").css("display", "none");
                tiled2.show();
                layerModelBaseMapMin.hide();
            }
            if (isShowSSB) {
                $('#showSSB').removeClass('active');
                isShowSSB = false;
                StopSubBefore.hide();
                $("#legendDivSoto").css("display", "none");
                tiled2.show();
                layerModelBaseMapMin.hide();
            }
        }
    }
    function changeCheck3() {
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        $("#gsjysc").attr("checked", false);
        $("#gslzsc").attr("checked", false);
        $("#gsxkhsc").attr("checked", false);
        $("#gsjbsc").attr("checked", false);
        gsscList = "";
        gsscList1 = "";
        gsscList2 = "";
        gsscList3 = "";
        gsscList4 = "";
        let stopType = $("#StopType").val();
        if ($("#xkhsc")[0].checked) {
            $("#planList").html("");
            $("#orderList").html("");
            $("#planResult").html("");
            $("#jysc").attr("disabled", "disabled");
            $("#lzsc").attr("disabled", "disabled");
            $("#jbsc").attr("disabled", "disabled");
            $("#gsxkhsc").attr("disabled", "disabled");
            if (stopType == "1" || stopType == "3") {
                $('#createPlanBut').removeClass('disabled');
                $("#createPlanBut").attr('disabled', false);
                if (stopType == "1")
                    scList3 = "12,0;";
                else scList3 = "12,;";
            } else {
                let bfb = parseFloat($("#xkhscText").val());
                if (isNaN(bfb)) {
                    $.modalAlert("系统提示", "请输入剩余产能的百分比数字！", "error");
                    $('#xkhsc').attr("checked", false);
                    $("#jysc").attr("disabled", false);
                    $("#lzsc").attr("disabled", false);
                    $("#jbsc").attr("disabled", false);
                    $("#gsxkhsc").attr("disabled", false);
                    return;
                }
                if (subCount == 3) {
                    $.modalAlert("系统提示", "最多只允许3个水厂减产！", "error");
                    $('#xkhsc').attr("checked", false);
                    $("#jysc").attr("disabled", false);
                    $("#lzsc").attr("disabled", false);
                    $("#jbsc").attr("disabled", false);
                    $("#gsxkhsc").attr("disabled", false);
                    return;
                }
                $('#createPlanBut').removeClass('disabled');
                $("#createPlanBut").attr('disabled', false);
                $('#xkhscText').addClass('disabled');
                $("#xkhscText").attr('disabled', true);
                subCount += 1;
                scList3 = "12," + bfb + ";";
            }
        } else {
            if (stopType == "2") {
                subCount -= 1;
                if (subCount == 0) {
                    $('#createPlanBut').addClass('disabled');
                    $("#createPlanBut").attr('disabled', true);
                }
            } else {
                $('#createPlanBut').addClass('disabled');
                $("#createPlanBut").attr('disabled', true);
            }
            $("#xkhscText").val('');
            scList3 = "";
            $("#jysc").attr("disabled", false);
            $("#lzsc").attr("disabled", false);
            $("#jbsc").attr("disabled", false);
            $("#gsxkhsc").attr("disabled", false);
            $("#xkhscText").attr("disabled", false);
            if (isShowSSA) {
                $('#showSSA').removeClass('active');
                isShowSSA = false;
                StopSubAfter.hide();
                $("#legendDivSoto").css("display", "none");
                tiled2.show();
                layerModelBaseMapMin.hide();
            }
            if (isShowSSB) {
                $('#showSSB').removeClass('active');
                isShowSSB = false;
                StopSubBefore.hide();
                $("#legendDivSoto").css("display", "none");
                tiled2.show();
                layerModelBaseMapMin.hide();
            }
        }
    }
    function changeCheck4() {
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        $("#gsjysc").attr("checked", false);
        $("#gslzsc").attr("checked", false);
        $("#gsxkhsc").attr("checked", false);
        $("#gsjbsc").attr("checked", false);
        gsscList = "";
        gsscList1 = "";
        gsscList2 = "";
        gsscList3 = "";
        gsscList4 = "";
        let stopType = $("#StopType").val();
        if ($("#jbsc")[0].checked) {
            $("#planList").html("");
            $("#orderList").html("");
            $("#planResult").html("");
            $("#jysc").attr("disabled", "disabled");
            $("#lzsc").attr("disabled", "disabled");
            $("#xkhsc").attr("disabled", "disabled");
            $("#gsjbsc").attr("disabled", "disabled");
            if (stopType == "1" || stopType == "3") {
                $('#createPlanBut').removeClass('disabled');
                $("#createPlanBut").attr('disabled', false);
                if (stopType == "1")
                    scList4 = "13,0;";
                else scList4 = "13,;";
            } else {
                let bfb = parseFloat($("#jbscText").val());
                if (isNaN(bfb)) {
                    $.modalAlert("系统提示", "请输入剩余产能的百分比数字！", "error");
                    $('#jbsc').attr("checked", false);
                    $("#jysc").attr("disabled", false);
                    $("#lzsc").attr("disabled", false);
                    $("#xkhsc").attr("disabled", false);
                    $("#gsjbsc").attr("disabled", false);
                    return;
                }
                if (subCount == 3) {
                    $.modalAlert("系统提示", "最多只允许3个水厂减产！", "error");
                    $('#jbsc').attr("checked", false);
                    $("#jysc").attr("disabled", false);
                    $("#lzsc").attr("disabled", false);
                    $("#xkhsc").attr("disabled", false);
                    $("#gsjbsc").attr("disabled", false);
                    return;
                }
                $('#createPlanBut').removeClass('disabled');
                $("#createPlanBut").attr('disabled', false);
                $('#jbscText').addClass('disabled');
                $("#jbscText").attr('disabled', true);
                subCount += 1;
                scList4 = "13," + bfb + ";";
            }
        } else {
            if (stopType == "2") {
                subCount -= 1;
                if (subCount == 0) {
                    $('#createPlanBut').addClass('disabled');
                    $("#createPlanBut").attr('disabled', true);
                }
            } else {
                $('#createPlanBut').addClass('disabled');
                $("#createPlanBut").attr('disabled', true);
            }
            $("#jbscText").val('');
            scList4 = "";
            $("#jysc").attr("disabled", false);
            $("#lzsc").attr("disabled", false);
            $("#xkhsc").attr("disabled", false);
            $("#gsjbsc").attr("disabled", false);
            $("#jbscText").attr("disabled", false);
            if (isShowSSA) {
                $('#showSSA').removeClass('active');
                isShowSSA = false;
                StopSubAfter.hide();
                $("#legendDivSoto").css("display", "none");
                tiled2.show();
                layerModelBaseMapMin.hide();
            }
            if (isShowSSB) {
                $('#showSSB').removeClass('active');
                isShowSSB = false;
                StopSubBefore.hide();
                $("#legendDivSoto").css("display", "none");
                tiled2.show();
                layerModelBaseMapMin.hide();
            }
        }
    }
    function gsChangeCheck1() {//水厂复选框调用事件
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        if ($("#gsjysc")[0].checked) {
            $("#planList").html("");
            $("#orderList").html("");
            $("#planResult").html("");
            gsscList1 = "10,";
        } else {
            gsscList1 = "";
        }
    }
    function gsChangeCheck2() {
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        if ($("#gslzsc")[0].checked) {
            $("#planList").html("");
            $("#orderList").html("");
            $("#planResult").html("");
            gsscList2 = "11,";
        } else {
            gsscList2 = "";
        }
    }
    function gsChangeCheck3() {
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        if ($("#gsxkhsc")[0].checked) {
            $("#planList").html("");
            $("#orderList").html("");
            $("#planResult").html("");
            gsscList3 = "12,";
        } else {
            gsscList3 = "";
        }
    }
    function gsChangeCheck4() {
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        if ($("#gsjbsc")[0].checked) {
            $("#planList").html("");
            $("#orderList").html("");
            $("#planResult").html("");
            gsscList4 = "13,";
        } else {
            gsscList4 = "";
        }
    }
    function createOrder() {
        var text_content = "";
        var xfdl_content = [];
        var Checkbox3 = document.getElementsByClassName("down1_1");
        var Checkbox3_realvalue = document.getElementsByClassName("down1_2");
        var Checkbox3_tagvalue = document.getElementsByClassName("down1_3");

        for (i = 0; i < Checkbox3.length; i++) {
            if (Number(Checkbox3_realvalue[i].innerText) != Number(Checkbox3_tagvalue[i].value)) {
                let object = [Checkbox3[i].innerText, Checkbox3_realvalue[i].innerText, Checkbox3_tagvalue[i].value];
                xfdl_content.push(object);
                //if (!xfdl_content[i][2]) {
                //    text_content += "<strong style='width:80px; display:inline-block'>" + xfdl_content[i][0] + "：</strong><strong style='width:160px; display:inline-block;text-align:right'>" + "当前水厂压力：" + xfdl_content[i][1] + "MPa" + "</strong><strong style='width:240px; display:inline-block;text-align:right'>方案供水压力：-MPa</strong><br/><br/>"
                //} else {
                //    text_content += "<strong style='width:80px; display:inline-block'>" + xfdl_content[i][0] + "：</strong><strong style='width:160px; display:inline-block;text-align:right'>" + "当前水厂压力：" + xfdl_content[i][1] + "MPa" + "</strong><strong style='width:240px; display:inline-block;text-align:right'>方案供水压力：" + xfdl_content[i][2] + "MPa</strong><br/><br/>"
                //}
            }
            if (i == Checkbox3.length - 1) {
                for (j = 0; j < xfdl_content.length; j++) {
                    if (xfdl_content[j][2]) {
                        text_content += "<strong style='width:80px; display:inline-block'>" + xfdl_content[j][0] + "：</strong><strong style='width:160px; display:inline-block;text-align:right'>" + "当前水厂压力：" + xfdl_content[j][1] + "MPa" + "</strong><strong style='width:240px; display:inline-block;text-align:right'>方案供水压力：" + xfdl_content[j][2] + "MPa</strong><br/><br/>"
                    }
                }
            }
        }
        $.modalConfirm(text_content, function (e) {
            if (e) {
                $('#scfaBut').addClass('disabled');
                $("#scfaBut").attr('disabled', true);
                let scList = "";
                let arr = document.getElementById("orderList").children
                for (let i = 0; i < arr.length; i++) {
                    if (arr[i].children[0].children[2].innerHTML != '-') {
                        let arr2 = arr[i].children[0].children[2].children
                        $("#" + arr2[0].id).attr("disabled", true);
                        scList += arr2[0].id + "," + arr2[0].value + ";"
                    }
                }
                $.loading(true, '下发调令中...');
                //console.log(scList)
                let stopType = $("#StopType").val();
                $.ajax({
                    type: "GET",
                    url: "/Scheduling/StopSubtract/CreateOrder?planId=" + planId + "&scList=" + scList.substring(0, scList.length - 1),
                    //dataType: "JSON",
                    success: function (data) {
                        //console.log(data);
                        $.loading();
                        $("#pdfFile").attr('src', data);
                        $.modalMsg("下发调令成功！", "success");
                    }
                });
            } else {
                $.modalMsg("已取消下发！", "success");
            }

        })
       
    }
    function changeSelect() {
        $('#createPlanBut').addClass('disabled');
        $("#createPlanBut").attr('disabled', true);
        $('#scfaBut').addClass('disabled');
        $("#scfaBut").attr('disabled', true);
        $('#showSSB').addClass('disabled');
        $("#showSSB").attr('disabled', true);
        $('#showSSA').addClass('disabled');
        $("#showSSA").attr('disabled', true);
        $('#but_mid2').addClass('disabled');
        $("#but_mid2").attr('disabled', true);
        let stopType = $("#StopType").val();
        scList = "";
        scList1 = "";
        scList2 = "";
        scList3 = "";
        scList4 = "";
        gsscList = "";
        gsscList1 = "";
        gsscList2 = "";
        gsscList3 = "";
        gsscList4 = "";
        subCount = 0;
        $("#jysc").attr("disabled", false);
        $("#lzsc").attr("disabled", false);
        $("#xkhsc").attr("disabled", false);
        $("#jbsc").attr("disabled", false);
        $("#gsjysc").attr("disabled", false);
        $("#gslzsc").attr("disabled", false);
        $("#gsxkhsc").attr("disabled", false);
        $("#gsjbsc").attr("disabled", false);
        $("#jysc").attr("checked", false);
        $("#lzsc").attr("checked", false);
        $("#xkhsc").attr("checked", false);
        $("#jbsc").attr("checked", false);
        $("#gsjysc").attr("checked", false);
        $("#gslzsc").attr("checked", false);
        $("#gsxkhsc").attr("checked", false);
        $("#gsjbsc").attr("checked", false);
        showJTSC();
        if (stopType == "3")
            $("#showGSSC").css("display", "none");
        else
            $("#showGSSC").css("display", "");
        if (stopType == "1" || stopType == "3") {
            $("#jyscText").css("display", "none");
            $("#lzscText").css("display", "none");
            $("#xkhscText").css("display", "none");
            $("#jbscText").css("display", "none");
            if (stopType == "1") {
                $("#showJTSC").html("停产水厂设置");
            } else {
                $("#showJTSC").html("减产水厂设置");
            }
        } else {
            $("#jyscText").css("display", "");
            $("#lzscText").css("display", "");
            $("#xkhscText").css("display", "");
            $("#jbscText").css("display", "");
            $("#showJTSC").html("减产水厂设置");
        }
        if (isShowSSA) {
            $('#showSSA').removeClass('active');
            isShowSSA = false;
            StopSubAfter.hide();
            $("#legendDivSoto").css("display", "none");
            tiled2.show();
            layerModelBaseMapMin.hide();
        }
        if (isShowSSB) {
            $('#showSSB').removeClass('active');
            isShowSSB = false;
            StopSubBefore.hide();
            $("#legendDivSoto").css("display", "none");
            tiled2.show();
            layerModelBaseMapMin.hide();
        }
        $("#planList").html("");
        $("#orderList").html("");
        $("#planResult").html("");
    }
    function btn_download1() {
        if (planId != undefined) {
            $.loading(true);
            $.ajax({
                type: "GET",
                url: "/Scheduling/StopSubtract/GetBeforeUserInfo?planId=" + planId,
                success: function (adata) {
                    let link = document.createElement('a');
                    link.href = adata;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    $.loading();
                    $.modalMsg("导出成功！", "success");
                }
            });
        }
    }
    function btn_download2() {
        if (planId != undefined) {
            $.loading(true);
            $.ajax({
                type: "GET",
                url: "/Scheduling/StopSubtract/GetAfterUserInfo?planId=" + planId,
                success: function (adata) {
                    let link = document.createElement('a');
                    link.href = adata;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    $.loading();
                    $.modalMsg("导出成功！", "success");
                }
            });
        }
    }
    //限制输入框只能输入数字90~100
    $('.input9_1').blur('input propertychang', function () {
        this.value = this.value.replace(/[^\d.]/g, ''); //清除“数字”和“.”以外的字符
        this.value = this.value.replace(/^\./g, ''); //验证第一个字符是数字而不是.
        this.value = this.value.replace(/\.{2,}/g, '.'); //只保留第一个. 清除多余的.
        this.value = this.value
            .replace('.', '$#$')
            .replace(/\./g, '')
            .replace('$#$', '.');
        //只能输入两个小数
        this.value = this.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');
        //输入替换，如输入05，直接替换为5，防止出现01，02这种情况
        if (this.value.indexOf('.') < 0 && this.value != '') {
            this.value = parseFloat(this.value);
        }

        if (this.value <= 100 && this.value >= 0) {
            this.value = this.value
        } else {
            alert("输入的值必须大于等于90且小于等于100")
            this.value = ""
        }
    })
    function but_mid1() {
        $('#middle').css("display", "none");
        $('#right').css("display", "");
        $('#mapbox').css("display", "");
        $('#but_mid1').addClass('active');
        $('#but_mid2').removeClass('active');
    }
    function but_mid2() {
        $('#middle').css("display", "");
        $('#right').css("display", "none");
        $('#mapbox').css("display", "none");
        $('#but_mid1').removeClass('active');
        $('#but_mid2').addClass('active');
    }
</script>
